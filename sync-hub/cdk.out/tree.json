{"version":"tree-0.1","tree":{"id":"App","path":"","constructInfo":{"fqn":"aws-cdk-lib.App","version":"2.214.0"},"children":{"SyncHubSimple":{"id":"SyncHubSimple","path":"SyncHubSimple","constructInfo":{"fqn":"aws-cdk-lib.Stack","version":"2.214.0"},"children":{"SettingsTable":{"id":"SettingsTable","path":"SyncHubSimple/SettingsTable","constructInfo":{"fqn":"aws-cdk-lib.aws_dynamodb.Table","version":"2.214.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"SyncHubSimple/SettingsTable/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_dynamodb.CfnTable","version":"2.214.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::DynamoDB::Table","aws:cdk:cloudformation:props":{"attributeDefinitions":[{"attributeName":"tenant_id","attributeType":"S"},{"attributeName":"setting_id","attributeType":"S"}],"billingMode":"PAY_PER_REQUEST","keySchema":[{"attributeName":"tenant_id","keyType":"HASH"},{"attributeName":"setting_id","keyType":"RANGE"}],"tableName":"sync-hub-settings"}}},"ScalingRole":{"id":"ScalingRole","path":"SyncHubSimple/SettingsTable/ScalingRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.214.0","metadata":[]}}}},"ApiFunction":{"id":"ApiFunction","path":"SyncHubSimple/ApiFunction","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.Function","version":"2.214.0","metadata":[]},"children":{"ServiceRole":{"id":"ServiceRole","path":"SyncHubSimple/ApiFunction/ServiceRole","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Role","version":"2.214.0","metadata":[]},"children":{"ImportServiceRole":{"id":"ImportServiceRole","path":"SyncHubSimple/ApiFunction/ServiceRole/ImportServiceRole","constructInfo":{"fqn":"aws-cdk-lib.Resource","version":"2.214.0","metadata":[]}},"Resource":{"id":"Resource","path":"SyncHubSimple/ApiFunction/ServiceRole/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnRole","version":"2.214.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Role","aws:cdk:cloudformation:props":{"assumeRolePolicyDocument":{"Statement":[{"Action":"sts:AssumeRole","Effect":"Allow","Principal":{"Service":"lambda.amazonaws.com"}}],"Version":"2012-10-17"},"managedPolicyArns":[{"Fn::Join":["",["arn:",{"Ref":"AWS::Partition"},":iam::aws:policy/service-role/AWSLambdaBasicExecutionRole"]]}]}}},"DefaultPolicy":{"id":"DefaultPolicy","path":"SyncHubSimple/ApiFunction/ServiceRole/DefaultPolicy","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.Policy","version":"2.214.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"SyncHubSimple/ApiFunction/ServiceRole/DefaultPolicy/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_iam.CfnPolicy","version":"2.214.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::IAM::Policy","aws:cdk:cloudformation:props":{"policyDocument":{"Statement":[{"Action":["dynamodb:BatchGetItem","dynamodb:GetRecords","dynamodb:GetShardIterator","dynamodb:Query","dynamodb:GetItem","dynamodb:Scan","dynamodb:ConditionCheckItem","dynamodb:BatchWriteItem","dynamodb:PutItem","dynamodb:UpdateItem","dynamodb:DeleteItem","dynamodb:DescribeTable"],"Effect":"Allow","Resource":[{"Fn::GetAtt":["SettingsTable4DB0CCD0","Arn"]},{"Ref":"AWS::NoValue"}]}],"Version":"2012-10-17"},"policyName":"ApiFunctionServiceRoleDefaultPolicy20A32B8D","roles":[{"Ref":"ApiFunctionServiceRole52B9747B"}]}}}}}}},"Resource":{"id":"Resource","path":"SyncHubSimple/ApiFunction/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnFunction","version":"2.214.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Function","aws:cdk:cloudformation:props":{"code":{"zipFile":"\nimport json\nimport uuid\nimport time\nimport boto3\nimport os\n\ndynamodb = boto3.resource('dynamodb')\ntable = dynamodb.Table(os.environ['SETTINGS_TABLE'])\n\ndef handler(event, context):\n    try:\n        method = event.get(\"requestContext\", {}).get(\"http\", {}).get(\"method\")\n        path = event.get(\"requestContext\", {}).get(\"http\", {}).get(\"path\")\n        \n        if path == \"/_health\":\n            return {\n                \"statusCode\": 200,\n                \"headers\": {\"Content-Type\": \"application/json\"},\n                \"body\": json.dumps({\"ok\": True, \"message\": \"Sync Hub API is running!\"})\n            }\n        \n        if path == \"/settings/public\":\n            response = table.scan(\n                FilterExpression=\"is_public = :public\",\n                ExpressionAttributeValues={\":public\": True}\n            )\n            return {\n                \"statusCode\": 200,\n                \"headers\": {\"Content-Type\": \"application/json\"},\n                \"body\": json.dumps({\"settings\": response.get(\"Items\", [])})\n            }\n        \n        if path == \"/settings\" and method == \"POST\":\n            body = json.loads(event.get(\"body\", \"{}\"))\n            setting = {\n                \"tenant_id\": \"default\",\n                \"setting_id\": str(uuid.uuid4()),\n                \"name\": body.get(\"name\", \"Sample Setting\"),\n                \"value\": body.get(\"value\", \"Sample Value\"),\n                \"is_public\": body.get(\"is_public\", True),\n                \"created_at\": int(time.time())\n            }\n            table.put_item(Item=setting)\n            return {\n                \"statusCode\": 201,\n                \"headers\": {\"Content-Type\": \"application/json\"},\n                \"body\": json.dumps(setting)\n            }\n        \n        return {\n            \"statusCode\": 404,\n            \"headers\": {\"Content-Type\": \"application/json\"},\n            \"body\": json.dumps({\"error\": \"Not found\"})\n        }\n        \n    except Exception as e:\n        return {\n            \"statusCode\": 500,\n            \"headers\": {\"Content-Type\": \"application/json\"},\n            \"body\": json.dumps({\"error\": str(e)})\n        }\n"},"environment":{"variables":{"SETTINGS_TABLE":{"Ref":"SettingsTable4DB0CCD0"}}},"handler":"index.handler","role":{"Fn::GetAtt":["ApiFunctionServiceRole52B9747B","Arn"]},"runtime":"python3.12","timeout":30}}},"ApiGatewayInvoke":{"id":"ApiGatewayInvoke","path":"SyncHubSimple/ApiFunction/ApiGatewayInvoke","constructInfo":{"fqn":"aws-cdk-lib.aws_lambda.CfnPermission","version":"2.214.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::Lambda::Permission","aws:cdk:cloudformation:props":{"action":"lambda:InvokeFunction","functionName":{"Fn::GetAtt":["ApiFunctionCE271BD4","Arn"]},"principal":"apigateway.amazonaws.com","sourceArn":{"Fn::Join":["",["arn:aws:execute-api:us-east-1:",{"Ref":"AWS::AccountId"},":",{"Ref":"HttpApiF5A9A8A7"},"/*/*"]]}}}}}},"HttpApi":{"id":"HttpApi","path":"SyncHubSimple/HttpApi","constructInfo":{"fqn":"aws-cdk-lib.aws_apigatewayv2.HttpApi","version":"2.214.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"SyncHubSimple/HttpApi/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_apigatewayv2.CfnApi","version":"2.214.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ApiGatewayV2::Api","aws:cdk:cloudformation:props":{"corsConfiguration":{"allowHeaders":["*"],"allowMethods":["*"],"allowOrigins":["*"]},"name":"sync-hub-simple-api","protocolType":"HTTP"}}},"DefaultStage":{"id":"DefaultStage","path":"SyncHubSimple/HttpApi/DefaultStage","constructInfo":{"fqn":"aws-cdk-lib.aws_apigatewayv2.HttpStage","version":"2.214.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"SyncHubSimple/HttpApi/DefaultStage/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_apigatewayv2.CfnStage","version":"2.214.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ApiGatewayV2::Stage","aws:cdk:cloudformation:props":{"apiId":{"Ref":"HttpApiF5A9A8A7"},"autoDeploy":true,"stageName":"$default"}}}}}}},"LambdaIntegration":{"id":"LambdaIntegration","path":"SyncHubSimple/LambdaIntegration","constructInfo":{"fqn":"aws-cdk-lib.aws_apigatewayv2.CfnIntegration","version":"2.214.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ApiGatewayV2::Integration","aws:cdk:cloudformation:props":{"apiId":{"Ref":"HttpApiF5A9A8A7"},"integrationType":"AWS_PROXY","integrationUri":{"Fn::GetAtt":["ApiFunctionCE271BD4","Arn"]},"payloadFormatVersion":"2.0"}}},"RouteGET_health":{"id":"RouteGET_health","path":"SyncHubSimple/RouteGET_health","constructInfo":{"fqn":"aws-cdk-lib.aws_apigatewayv2.CfnRoute","version":"2.214.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ApiGatewayV2::Route","aws:cdk:cloudformation:props":{"apiId":{"Ref":"HttpApiF5A9A8A7"},"routeKey":"GET /_health","target":{"Fn::Join":["",["integrations/",{"Ref":"LambdaIntegration"}]]}}}},"RouteGETsettingspublic":{"id":"RouteGETsettingspublic","path":"SyncHubSimple/RouteGETsettingspublic","constructInfo":{"fqn":"aws-cdk-lib.aws_apigatewayv2.CfnRoute","version":"2.214.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ApiGatewayV2::Route","aws:cdk:cloudformation:props":{"apiId":{"Ref":"HttpApiF5A9A8A7"},"routeKey":"GET /settings/public","target":{"Fn::Join":["",["integrations/",{"Ref":"LambdaIntegration"}]]}}}},"RoutePOSTsettings":{"id":"RoutePOSTsettings","path":"SyncHubSimple/RoutePOSTsettings","constructInfo":{"fqn":"aws-cdk-lib.aws_apigatewayv2.CfnRoute","version":"2.214.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::ApiGatewayV2::Route","aws:cdk:cloudformation:props":{"apiId":{"Ref":"HttpApiF5A9A8A7"},"routeKey":"POST /settings","target":{"Fn::Join":["",["integrations/",{"Ref":"LambdaIntegration"}]]}}}},"ApiUrlParam":{"id":"ApiUrlParam","path":"SyncHubSimple/ApiUrlParam","constructInfo":{"fqn":"aws-cdk-lib.aws_ssm.StringParameter","version":"2.214.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"SyncHubSimple/ApiUrlParam/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_ssm.CfnParameter","version":"2.214.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::SSM::Parameter","aws:cdk:cloudformation:props":{"name":"/sync-hub/api/url","type":"String","value":{"Fn::GetAtt":["HttpApiF5A9A8A7","ApiEndpoint"]}}}}}},"SettingsTableParam":{"id":"SettingsTableParam","path":"SyncHubSimple/SettingsTableParam","constructInfo":{"fqn":"aws-cdk-lib.aws_ssm.StringParameter","version":"2.214.0","metadata":[]},"children":{"Resource":{"id":"Resource","path":"SyncHubSimple/SettingsTableParam/Resource","constructInfo":{"fqn":"aws-cdk-lib.aws_ssm.CfnParameter","version":"2.214.0"},"attributes":{"aws:cdk:cloudformation:type":"AWS::SSM::Parameter","aws:cdk:cloudformation:props":{"name":"/sync-hub/data/settings-table","type":"String","value":{"Ref":"SettingsTable4DB0CCD0"}}}}}},"ApiUrl":{"id":"ApiUrl","path":"SyncHubSimple/ApiUrl","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.214.0"}},"SettingsTableName":{"id":"SettingsTableName","path":"SyncHubSimple/SettingsTableName","constructInfo":{"fqn":"aws-cdk-lib.CfnOutput","version":"2.214.0"}},"CDKMetadata":{"id":"CDKMetadata","path":"SyncHubSimple/CDKMetadata","constructInfo":{"fqn":"constructs.Construct","version":"10.4.2"},"children":{"Default":{"id":"Default","path":"SyncHubSimple/CDKMetadata/Default","constructInfo":{"fqn":"aws-cdk-lib.CfnResource","version":"2.214.0"}}}},"BootstrapVersion":{"id":"BootstrapVersion","path":"SyncHubSimple/BootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnParameter","version":"2.214.0"}},"CheckBootstrapVersion":{"id":"CheckBootstrapVersion","path":"SyncHubSimple/CheckBootstrapVersion","constructInfo":{"fqn":"aws-cdk-lib.CfnRule","version":"2.214.0"}}}},"Tree":{"id":"Tree","path":"Tree","constructInfo":{"fqn":"constructs.Construct","version":"10.4.2"}}}}}